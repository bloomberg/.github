name: scorecard-monitor

on:
  # Scheduled trigger
  schedule:
    # Run every Sunday at 00:00
    - cron: "0 0 * * 0"
  # Manual trigger
  workflow_dispatch:

permissions:
  contents: none
  pull-requests: none
  issues: none
  packages: none

env:
  ORG_LIST: "bloomberg"
  TARGET_BRANCH: "main"

jobs:
  scorecard-monitor:
    runs-on: ubuntu-latest
    permissions:
      # Required to update local files with the reports
      contents: write
      # Required to create pull requests
      pull-requests: write
      # Required to create issues
      issues: write
    steps:
      - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
        with:
          persist-credentials: false
      - name: üîç run scorecard monitor
        uses: ossf/scorecard-monitor@a3a9c4cfa0684480ec5f86fa178fc22c4394b69e # v2.0.0-beta8
        id: scorecard-monitor
        with:
          scope: reports/scorecard/scope.json
          database: reports/scorecard/database.json
          report: reports/scorecard/report.md
          auto-commit: false
          auto-push: false
          generate-issue: false
          github-token: ${{ secrets.GITHUB_TOKEN }}
          discovery-enabled: true
          discovery-orgs: ${{ env.ORG_LIST }}
      - name: üñ®Ô∏è print the scores
        run: |
          echo "${SCORECARD_SCORES}"
        env:
          SCORECARD_SCORES: ${{ steps.scorecard-monitor.outputs.scores }}
      - name: üîÉ create pull request
        uses: peter-evans/create-pull-request@84ae59a2cdc2258d6fa0732dd66352dddae2a412 # v7.0.9
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: Add latest results to Scorecard Monitor report
          title: üîç Scorecard Monitor Report Update
          body: This pull request has been automatically filed by Scorecard Monitor.
          base: ${{ env.TARGET_BRANCH }}
          assignees: ${{ github.actor }}
          branch: scorecard-monitor-report-update
          delete-branch: true
